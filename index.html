<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bazaarika Free Fire Tournament | Register Now</title>
  <meta name="description" content="Join the Bazaarika Free Fire Tournament. Free entry, cash prizes, and gifts! Register now." />
  <meta property="og:title" content="Bazaarika Free Fire Tournament ‚Äì Register Now" />
  <meta property="og:description" content="Free entry ‚Ä¢ Win ‚Çπ100 + Gifts ‚Ä¢ Limited slots ‚Ä¢ Register at bazaarika.in" />
  <meta property="og:image" content="https://i.postimg.cc/W3ZZ34MS/IMG-20250814-230211.jpg" />
  <meta property="og:type" content="website" />
  <meta name="theme-color" content="#120a16" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #120a16;
      --card-bg: #1e1327;
      --text-light: #f4e8fa;
      --text-muted: #9c89af;
      --primary-color: #f72585; /* Pink */
      --secondary-color: #4361ee; /* Blue */
      --accent-color: #4cc9f0;  /* Cyan */
      --success-color: #38b000;
      --danger-color: #e00021;
    }
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg-dark);
      color: var(--text-light);
      line-height: 1.6;
      overflow-x: hidden;
      position: relative;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        to bottom right,
        rgba(247, 37, 133, 0.1),
        rgba(67, 97, 238, 0.1)
      );
      pointer-events: none;
      z-index: -1;
      animation: pulse-bg 15s infinite alternate ease-in-out;
    }
    @keyframes pulse-bg {
      from { transform: scale(1); }
      to { transform: scale(1.1); }
    }
    a {
      color: var(--accent-color);
      text-decoration: none;
      transition: color 0.3s;
    }
    a:hover {
      color: var(--primary-color);
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px;
    }
    @media (max-width: 600px) {
        .container {
            padding: 10px;
        }
    }
    /* Header */
    header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(18, 10, 22, 0.8);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      animation: fadeInDown 0.8s forwards;
    }
    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 10px 0;
    }
    @media (max-width: 600px) {
        .nav {
            flex-wrap: wrap;
            justify-content: center;
            text-align: center;
            padding: 5px 0;
        }
        .brand, .cta-row {
            flex: 1 1 100%;
            justify-content: center;
            text-align: center;
        }
        .brand h1 { font-size: 14px; }
        .cta-row { margin-top: 10px; }
        .btn { flex: 1; }
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .brand img {
      width: 42px;
      height: 42px;
      object-fit: contain;
      border-radius: 10px;
      box-shadow: 0 0 0 2px rgba(247, 37, 133, 0.2);
    }
    .brand h1 {
      font-family: 'Roboto Mono', monospace;
      font-size: 15px;
      margin: 0;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      color: var(--accent-color);
    }
    .cta-row {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .btn {
      padding: 10px 18px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: var(--card-bg);
      color: var(--text-light);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease-in-out;
      position: relative;
      overflow: hidden;
    }
    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 300%;
      height: 300%;
      background: rgba(255, 255, 255, 0.1);
      transition: all 0.6s ease-out;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      opacity: 0;
    }
    .btn:hover::before {
      width: 0;
      height: 0;
      opacity: 1;
    }
    .btn.primary {
      background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
      color: #fff;
      border: none;
      box-shadow: 0 0 15px rgba(247, 37, 133, 0.4);
    }
    .btn.primary:hover {
      box-shadow: 0 0 25px rgba(247, 37, 133, 0.6);
      transform: translateY(-2px);
    }
    .btn.ghost {
      background: transparent;
      font-size: 15px;
      border: none;
      padding: 10px;
      color: var(--text-muted);
    }

    /* Hero */
    .hero {
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.45);
      animation: fadeInScale 1s forwards;
    }
    .hero img {
      display: block;
      width: 100%;
      aspect-ratio: 16/9;
      object-fit: cover;
      filter: saturate(1.1) brightness(0.8) contrast(1.1);
    }
    @media (max-width: 600px) {
        .hero {
            border-radius: 12px;
        }
        .hero h2 {
            font-size: 20px;
        }
        .hero-content {
            padding: 15px;
        }
    }
    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6) 40%, rgba(0, 0, 0, 0.85));
      display: flex;
      align-items: flex-end;
    }
    .hero-content {
      padding: 22px;
    }
    .badge {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      background: rgba(247, 37, 133, 0.2);
      border: 1px solid rgba(247, 37, 133, 0.4);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .hero h2 {
      font-family: 'Poppins', sans-serif;
      font-size: 28px;
      margin: 10px 0 6px;
      color: var(--accent-color);
      text-shadow: 0 0 10px rgba(76, 201, 240, 0.6);
    }
    .hero p {
      margin: 0;
      color: var(--text-muted);
    }

    /* Grid */
    .grid {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 20px;
      margin-top: 18px;
    }
    @media (max-width: 920px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--card-bg);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.35);
      overflow: hidden;
      position: relative;
      animation: fadeInSlideUp 0.8s forwards;
      opacity: 0;
      transform: translateY(20px);
    }
    .card:nth-child(2) { animation-delay: 0.2s; }
    .card:nth-child(3) { animation-delay: 0.4s; }

    @media (max-width: 600px) {
        .card {
            border-radius: 12px;
            padding: 15px;
        }
        .card h3 {
            font-size: 18px;
        }
    }
    .card h3 {
      margin: 0 0 12px;
      font-family: 'Roboto Mono', monospace;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      color: var(--accent-color);
    }
    .muted {
      color: var(--text-muted);
    }

    /* Prizes */
    .prize-list {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    @media (max-width: 700px) {
      .prize-list {
        grid-template-columns: 1fr;
      }
    }
    .prize {
      padding: 14px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.08);
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease-in-out;
    }
    @media (max-width: 600px) {
        .prize {
            padding: 10px;
        }
    }
    .prize::before {
      content: '';
      position: absolute;
      inset: -10px;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.05), transparent 50%);
      transform: rotate(45deg);
      transition: all 0.5s ease;
      opacity: 0;
    }
    .prize:hover::before {
      transform: rotate(0deg);
      opacity: 1;
    }
    .prize h4 {
      margin: 0 0 8px;
    }
    .prize .tag {
      display: inline-block;
      margin-top: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px dashed var(--primary-color);
      font-size: 12px;
      color: var(--primary-color);
    }
    .p1 h4 { color: gold; }
    .p2 h4 { color: silver; }
    .p3 h4 { color: #cd7f32; }

    /* Form */
    form {
      display: grid;
      gap: 12px;
    }
    label {
      font-weight: 600;
      color: var(--accent-color);
    }
    input, select, textarea {
      width: 100%;
      padding: 12px 12px;
      border-radius: 12px;
      background: #140b1b;
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--text-light);
      font-size: 16px;
      transition: all 0.3s;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(247, 37, 133, 0.2);
    }
    .two {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 700px) {
      .two {
        grid-template-columns: 1fr;
      }
    }
    .terms {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      font-size: 14px;
      color: var(--text-muted);
    }
    .terms input {
      width: auto;
      margin-top: 4px;
    }

    /* Table */
    .table-container {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    table {
      width: 100%;
      min-width: 500px;
      border-collapse: separate;
      border-spacing: 0 8px;
      font-family: 'Roboto Mono', monospace;
    }
    th, td {
      text-align: left;
      padding: 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    thead th {
      font-size: 13px;
      color: var(--text-muted);
    }
    tbody tr {
      background: #1e1327;
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 10px;
      transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
      animation: fadeIn 0.5s forwards;
    }
    tbody tr:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    }
    tbody tr td:first-child { border-radius: 10px 0 0 10px; }
    tbody tr td:last-child { border-radius: 0 10px 10px 0; }
    
    /* Footer */
    footer {
      margin: 30px 0 60px;
      color: var(--text-muted);
      text-align: center;
      font-family: 'Roboto Mono', monospace;
    }

    /* Toast */
    .toast {
      position: fixed;
      right: 18px;
      bottom: 18px;
      background: #1e1327;
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 12px 14px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      z-index: 100;
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0;
      transform: translateY(20px);
      animation: toast-in 0.4s forwards;
    }
    .toast.ok { border-color: rgba(56, 176, 0, 0.5); }
    .toast.err { border-color: rgba(224, 0, 33, 0.5); }
    .toast .icon {
      width: 20px;
      height: 20px;
      background: var(--success-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: sans-serif;
      font-weight: bold;
    }
    @keyframes toast-in {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* New Registration Toast */
    .new-reg-toast {
      background: linear-gradient(90deg, #1e1327, rgba(247, 37, 133, 0.2));
      border: 1px solid rgba(247, 37, 133, 0.4);
    }
    @media (max-width: 600px) {
        .toast {
            right: 10px;
            bottom: 10px;
            width: calc(100% - 20px);
            max-width: none;
        }
    }

    /* Keyframes */
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes fadeInSlideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <img src="https://i.postimg.cc/L5N86d0N/20250804-105521.png" alt="Bazaarika Logo" />
        <h1>Bazaarika FF Tournament</h1>
      </div>
      <div class="cta-row">
        <a class="btn ghost" href="https://bazaarika.in/" target="_blank" rel="noopener">bazaarika.in‚Üó</a>
        <a class="btn primary" href="#register">Register Now</a>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="hero" aria-label="Tournament Hero">
      <img src="https://i.postimg.cc/W3ZZ34MS/IMG-20250814-230211.jpg" alt="Bazaarika Free Fire Tournament Thumbnail" />
      <div class="hero-overlay">
        <div class="hero-content">
          <span class="badge">FREE ENTRY ‚Ä¢ LIMITED SLOTS</span>
          <h2>Win Cash ‚Çπ100 + Gifts ‚Ä¢ Esports Style</h2>
          <p>Register now ‚Ä¢ Share with your squad ‚Ä¢ Play fair ‚Ä¢ Claim rewards</p>
        </div>
      </div>
    </section>

    <div class="grid">
      <section class="card">
        <h3>üéÆ Tournament Details</h3>
        
        <h4>Turnament date is 18/08/2025</h4>
        <p class="muted">Format: <b>Solo Battle</b> (beginner-friendly). Map: <b>Bermuda</b>. Room details will be sent to registered players on match day.</p>
        <div class="prize-list" style="margin:14px 0 8px">
          <div class="prize">
            <h4>ü•á 1st Prize: ‚Çπ100 + Bazaarika Gift</h4>
            <div class="tag">Winner Spotlight on Socials</div>
          </div>
          <div class="prize">
            <h4>ü•à 2nd Prize: ‚Çπ50 + Discount Coupon</h4>
            <div class="tag">Extra Loot on Orders</div>
          </div>
          <div class="prize">
            <h4>ü•â 3rd Prize: ‚Çπ30 + Discount Coupon</h4>
            <div class="tag">Save more on Bazaarika</div>
          </div>
        </div>
        <p class="muted">All players get a special code: <b>FFGAME10</b> (flat 10% off*). *T&C apply.</p>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,.08);margin:14px 0">

        <h3 id="register">üìù Register Now</h3>
        <form id="regForm">
          <div class="two">
            <div>
              <label for="playerName">Player Name / ‡§®‡§æ‡§Æ *</label>
              <input id="playerName" name="playerName" required placeholder="e.g., Raj Kumar" />
            </div>
            <div>
              <label for="ffuid">Free Fire UID *</label>
              <input id="ffuid" name="ffuid" required inputmode="numeric" pattern="[0-9]{4,}" placeholder="12-digit UID" />
            </div>
          </div>
          <div class="two">
            <div>
              <label for="mode">Mode *</label>
              <select id="mode" name="mode" required>
                <option value="Solo" selected>Solo</option>
                <option value="Duo">Duo</option>
                <option value="Squad">Squad</option>
              </select>
            </div>
            <div>
              <label for="whatsapp">WhatsApp Number *</label>
              <input id="whatsapp" name="whatsapp" required inputmode="tel" placeholder="10-digit mobile" pattern="[0-9]{10}" />
            </div>
          </div>
          <div class="two">
            <div>
              <label for="city">village / ‡§ó‡§æ‡§Å‡§µ</label>
              <input id="city" name="city" placeholder="Your village/city" />
            </div>
            <div>
              <label for="age">Age / ‡§â‡§Æ‡•ç‡§∞</label>
              <input id="age" name="age" inputmode="numeric" pattern="[0-9]{1,2}" placeholder="16" />
            </div>
          </div>
          <div>
            <label for="ref">How did you hear? (Optional)</label>
            <select id="ref" name="ref">
              <option value="Instagram">Instagram</option>
              <option value="WhatsApp">WhatsApp</option>
              <option value="Telegram">Telegram</option>
              <option value="Friend">Friend</option>
              <option value="Other" selected>Other</option>
            </select>
          </div>
          <div>
            <label for="notes">Notes (Optional)</label>
            <textarea id="notes" name="notes" rows="3" placeholder="Any request‚Ä¶"></textarea>
          </div>
          <div class="terms">
            <input type="checkbox" id="agree" required />
            <label for="agree">I agree to fair-play rules. No hacks/scripts. Disqualification on violation.</label>
          </div>
          <button class="btn primary" type="submit" id="payBtn">Pay ‚Çπ10 & Register</button>
          <div id="status" class="muted" style="margin-top:8px"></div>
        </form>
      </section>

      <aside class="card">
        <h3>‚ö° Quick Info</h3>
        <ul>
          <li>Entry Fee: <b>‚Çπ10/- only</b></li>
          <li>Slots: <b>Limited</b> (first come, first served)</li>
          <li>Room ID/Pass: shared on WhatsApp before match</li>
          <li>Contact: <a href="https://bazaarika.in/" target="_blank" rel="noopener">bazaarika.in</a></li>
        </ul>
        <h3 style="margin-top:16px">üìú Rules</h3>
        <ol>
          <li>Only one account per player.</li>
          <li>No emulators, no hacks, no teaming (Solo).</li>
          <li>Ping/Network is player responsibility.</li>
          <li>Screenshot winners + in-game results are final.</li>
        </ol>
        <h3 style="margin-top:16px">üßæ Recent Registrations</h3>
        <div id="regWrap" class="table-container">
          <table>
            <thead>
              <tr>
                <th>Player</th>
                <th>UID</th>
                <th>Mode</th>
                <th>City</th>
              </tr>
            </thead>
            <tbody id="regTable">
              <tr><td colspan="4" class="muted">Loading‚Ä¶</td></tr>
            </tbody>
          </table>
        </div>
      </aside>
    </div>

    <section class="card" style="margin-top:18px">
      <h3>üõçÔ∏è Bazaarika Offers</h3>
      <p>Use code <b>FFGAME10</b> on <a href="https://bazaarika.in/" target="_blank" rel="noopener">bazaarika.in</a> to get <b>10% OFF</b> on select categories. Winners will also receive exclusive gifts from Bazaarika. Follow us on social for upcoming tournaments!</p>
      <p class="muted" style="font-size:13px; margin-top:12px;">Disclaimer: Tournament rules and prize details are subject to change. Bazaarika reserves the right to make final decisions on all matters.</p>
    </section>

    <footer>
      ¬© <span id="yy"></span> Bazaarika ‚Ä¢ Made for gamers, by gamers.
    </footer>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
  // ====== CONFIG ======
  const BLOB_URL = "https://jsonblob.com/api/jsonBlob/1405605860281081856"; 
  const RAZORPAY_KEY = "rzp_live_JmgFv3psLlrZFr";
  const PAYMENT_AMOUNT = 1000; // 10 ‡§∞‡•Å‡§™‡§Ø‡•á = 1000 ‡§™‡•à‡§∏‡•á
  const PAYMENT_ENABLED = true; // ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ï‡•ã ‡§Ü‡§∏‡§æ‡§®‡•Ä ‡§∏‡•á ‡§ö‡§æ‡§≤‡•Ç/‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è

  // ====== UTIL ======
  const qs = (s, el = document) => el.querySelector(s);
  const ce = (tag, props = {}) => Object.assign(document.createElement(tag), props);

  const showToast = (msg, isSuccess = true, isNewReg = false) => {
    const t = qs('#toast');
    t.innerHTML = `<span class="icon">${isSuccess ? '‚úì' : '‚úó'}</span> ${msg}`;
    t.className = `toast ${isSuccess ? 'ok' : 'err'} ${isNewReg ? 'new-reg-toast' : ''}`;
    t.style.animation = 'none';
    t.offsetHeight;
    t.style.animation = `toast-in 0.4s forwards, fadeOut 0.4s 3.8s forwards`;
  };

  const setStatus = (msg, isSuccess = false) => {
    const statusEl = qs('#status');
    statusEl.textContent = msg;
    statusEl.style.color = isSuccess ? 'var(--success-color)' : 'var(--text-muted)';
  };

  const formatRow = (r) => {
    const tr = ce('tr');
    tr.append(
      ce('td', { textContent: r.playerName || '-' }),
      ce('td', { textContent: r.ffuid || '-' }),
      ce('td', { textContent: r.mode || '-' }),
      ce('td', { textContent: r.city || '-' })
    );
    return tr;
  };

  const animateNewRow = (row) => {
    row.style.opacity = 0;
    row.style.transform = 'scale(0.95)';
    row.style.animation = `fadeInScale 0.5s forwards`;
  };

  // ====== DATA LAYER (Optimized) ======
  async function loadRegistrations() {
    try {
      const res = await fetch(BLOB_URL, { method: 'GET', headers: { 'Accept': 'application/json' } });
      if (!res.ok) return [];
      const data = await res.json().catch(() => ({}));
      return (data && Array.isArray(data.registrations)) ? data.registrations : [];
    } catch (e) {
      console.error('Error fetching registrations:', e);
      return [];
    }
  }

  async function saveRegistration(newItem) {
    try {
      const all = await loadRegistrations();
      const withTime = { ...newItem, createdAt: new Date().toISOString() };
      all.unshift(withTime);
      const body = JSON.stringify({ registrations: all }, null, 2);
      const res = await fetch(BLOB_URL, {
        method: 'PUT',
        mode: 'cors',
        headers: { 'Content-Type': 'application/json' },
        body
      });
      if (!res.ok) throw new Error('Failed to save data: ' + res.status);
      return withTime;
    } catch (e) {
      console.error('Error saving registration:', e);
      throw e;
    }
  }

  // ====== UI BINDINGS ======
  async function refreshTable(newItem = null) {
    const tbody = qs('#regTable');
    if (!newItem) {
      tbody.innerHTML = '<tr><td colspan="4" class="muted">Loading‚Ä¶</td></tr>';
      const rows = await loadRegistrations();
      tbody.innerHTML = '';
      if (!rows.length) {
        tbody.innerHTML = '<tr><td colspan="4" class="muted">No registrations yet. Be the first!</td></tr>';
        return;
      }
      rows.slice(0, 20).forEach(r => tbody.append(formatRow(r)));
    } else {
      const newRow = formatRow(newItem);
      tbody.prepend(newRow);
      animateNewRow(newRow);
      while (tbody.rows.length > 20) {
        tbody.deleteRow(20);
      }
    }
  }

  function validateForm(data) {
    if (!data.playerName || !data.ffuid || !data.whatsapp) {
      showToast('Please fill all required fields.', false);
      return false;
    }
    if (!/^[0-9]{4,}$/.test(data.ffuid)) {
      showToast('Enter a valid Free Fire UID (at least 4 digits).', false);
      return false;
    }
    if (!/^[0-9]{10}$/.test(data.whatsapp)) {
      showToast('Enter a valid 10-digit WhatsApp number.', false);
      return false;
    }
    if (!qs('#agree').checked) {
      showToast('Please accept the fair-play rules.', false);
      return false;
    }
    return true;
  }

  async function handlePaymentAndRegistration(data) {
    setStatus('Initiating payment...', false);
    const options = {
      key: RAZORPAY_KEY,
      amount: PAYMENT_AMOUNT,
      currency: "INR",
      name: "Bazaarika Tournament",
      description: "Registration Fee ‚Çπ10",
      handler: async function (response) {
        setStatus('Payment successful. Verifying...', false);
        try {
          const regData = {
            playerName: data.playerName.trim(),
            ffuid: data.ffuid.trim(),
            mode: data.mode,
            whatsapp: data.whatsapp.trim(),
            city: (data.city || '').trim(),
            age: (data.age || '').trim(),
            ref: data.ref,
            notes: (data.notes || '').trim(),
            payment_id: response.razorpay_payment_id
          };
          
          const savedReg = await saveRegistration(regData);
          
          showToast(`‚úÖ ${savedReg.playerName} registered!`, true, true);
          qs('#regForm').reset();
          qs('#agree').checked = false;
          setStatus('Success! Your slot will be confirmed on WhatsApp.', true);
          refreshTable(savedReg);
        } catch (err) {
          console.error('Error during registration after payment:', err);
          showToast('‚ùå Error saving registration. Contact support with your payment ID: ' + response.razorpay_payment_id, false);
          setStatus('Error saving registration. Please contact support.', false);
        }
      },
      prefill: {
        name: data.playerName,
        contact: data.whatsapp
      },
      theme: { color: "#f72585" }
    };

    const rzp = new Razorpay(options);
    
    rzp.on('payment.failed', function(response) {
      console.error('Payment failed:', response);
      showToast('‚ùå Payment failed. Please try again.', false);
      setStatus('Payment failed. Please try again.', false);
    });

    rzp.on('checkout.close', function() {
      setStatus('Payment window closed. Please complete payment to register.', false);
    });
    
    rzp.open();
  }

  async function onSubmit(e) {
    e.preventDefault();
    const form = e.currentTarget;
    const data = Object.fromEntries(new FormData(form).entries());
    const submitBtn = qs('#payBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Processing...';

    if (!validateForm(data)) {
      submitBtn.disabled = false;
      submitBtn.textContent = `Pay ‚Çπ${PAYMENT_AMOUNT / 100} & Register`;
      return;
    }
    
    if (PAYMENT_ENABLED) {
      handlePaymentAndRegistration(data)
        .finally(() => {
          submitBtn.disabled = false;
          submitBtn.textContent = `Pay ‚Çπ${PAYMENT_AMOUNT / 100} & Register`;
        });
    } else { // Bypass payment for testing/free entry
        try {
          const savedReg = await saveRegistration(data);
          showToast(`‚úÖ ${savedReg.playerName} registered!`, true, true);
          form.reset();
          qs('#agree').checked = false;
          setStatus('Success! Your slot is confirmed.', true);
          refreshTable(savedReg);
        } catch (err) {
          showToast('‚ùå Error saving registration.', false);
          setStatus('Error saving registration. Please try again.', false);
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = 'Register (Free)';
        }
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    qs('#yy').textContent = new Date().getFullYear();
    refreshTable();
    qs('#regForm').addEventListener('submit', onSubmit);
    qs('#payBtn').textContent = PAYMENT_ENABLED ? `Pay ‚Çπ${PAYMENT_AMOUNT / 100} & Register` : 'Register (Free)';
  });
</script>

</body>
</html>
